services:
  # Web Service
  - type: web
    name: flask-app
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: |
      celery -A flaskapp.celery_app worker --loglevel=info --concurrency=1 &
      gunicorn "flaskapp:create_app()" --config gunicorn.conf.py
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: SECRET_KEY
        generateValue: true
      - key: REDIS_URL
        fromService:
          name: flask-redis
          type: redis
          property: connectionString
      - key: CHAT_REDIS_URL
        fromService:
          name: flask-redis
          type: redis
          property: connectionString
      # Firebase Web SDK Configuration
      - key: FIREBASE_API_KEY
        value: AIzaSyD3DQtGspj3lNugVxx7y1_9xp6jHSbObho
      - key: FIREBASE_AUTH_DOMAIN
        value: irlmbm.firebaseapp.com
      - key: FIREBASE_PROJECT_ID
        value: irlmbm
      - key: FIREBASE_STORAGE_BUCKET
        value: irlmbm.appspot.com
      - key: FIREBASE_MESSAGING_SENDER_ID
        value: 982307418356
      - key: FIREBASE_APP_ID
        value: 1:982307418356:web:9ccb5775638f5fb40c2ea1
      # Firebase Admin SDK Configuration
      - key: FIREBASE_CREDENTIALS_JSON
        value: '{
          "type": "service_account",
          "project_id": "irlmbm",
          "private_key_id": "35e9808542c2c7b5d6e3f1a9c2d8b7f6e5d4c3b2",
          "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC9QFRkU5RH5J+L\n...\n-----END PRIVATE KEY-----\n",
          "client_email": "firebase-adminsdk-p4dxq@irlmbm.iam.gserviceaccount.com",
          "client_id": "112233445566778899001",
          "auth_uri": "https://accounts.google.com/o/oauth2/auth",
          "token_uri": "https://oauth2.googleapis.com/token",
          "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
          "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-p4dxq%40irlmbm.iam.gserviceaccount.com",
          "universe_domain": "googleapis.com"
        }'
      # Google AI Configuration
      - key: GOOGLE_API_KEY
        value: AIzaSyCFDHM6Gti_sKFaPHkEAcYz5pp5T2b4OWs

  # Redis instance
  - type: redis
    name: flask-redis
    ipAllowList:
      - source: 0.0.0.0/0
        description: everywhere
    plan: free
